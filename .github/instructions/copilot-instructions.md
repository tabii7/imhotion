# AI Coding Agent Instructions - Project Management System

## Architecture Overview

This is a **Laravel 12 + Filament v3** project management application with dual-panel architecture:
- **Admin Panel** (`/admin`) - Full CRUD management with Filament Resources
- **Client Panel** (`/client`) - Client-specific project views 
- **Document Management** - File upload/download with AJAX operations

## Key Components

### Models & Relationships
- `Project` → `User` (belongsTo client)
- `Project` → `ProjectDocument[]` (hasMany documents)
- Projects have status workflow: `in_progress → completed → finalized` etc.

### Filament Structure
- **Admin Resources**: `app/Filament/Admin/Resources/` - Admin-only management
- **Client Resources**: `app/Filament/Resources/` - Client-accessible views
- **Custom Views**: `resources/views/filament/projects/row-details.blade.php` - Modal components

### Document System
- Files stored in `storage/app/public/project-docs/{project_id}/`
- AJAX endpoints in `ProjectDocumentController` for upload/rename/hide operations
- Custom Blade component uses Alpine.js for real-time interactions

## Development Patterns

### Filament Customizations
```php
// Use expandableColumn() for detail modals
Tables\Columns\TextColumn::make('title')
    ->expandableColumn()
    ->modalContentView('filament.projects.row-details')
```

### Alpine.js + AJAX Pattern
```javascript
// Inline Alpine for immediate AJAX operations
@keydown.enter="
    fetch('/admin/projects/{id}/documents/{docId}/rename', {
        method: 'POST',
        headers: { 'X-CSRF-TOKEN': '{{ csrf_token() }}' },
        body: JSON.stringify({ name, filename })
    }).then(response => /* handle */ )
"
```

### Migration Strategy
- **Idempotent migrations**: Check column existence before adding
- **Status fields**: Use enums for project workflow states
- **Timestamp fields**: Separate `due_date`, `completed_at`, `delivery_date`

## Critical Workflows

### Development Servers
```bash
# Start both servers simultaneously
php artisan serve  # Backend on :8000
npm run dev       # Vite frontend on :5173
```

### File Operations
- Document uploads via Filament's `FileUpload::make()` components
- AJAX rename operations preserve filename while updating display name
- Hidden documents use `is_hidden` flag instead of deletion

### Database Seeding
```bash
php artisan db:seed --class=DemoSeeder  # Sample projects
php artisan optimize:clear               # Clear caches
```

## Project-Specific Conventions

### Status Management
Projects use workflow-based status with metadata fields:
- `pending_note` - Why project is pending
- `cancel_reason` - Cancellation details  
- `completed_at` - Completion timestamp

### Route Organization
- `/admin/*` - Admin panel routes (auto-generated by Filament)
- `/admin/projects/{project}/documents/*` - Custom document AJAX endpoints
- `/client/*` - Client-facing views

### Frontend Stack
- **TailwindCSS** for styling
- **Alpine.js** for reactive components (no Vue/React)
- **Vite** for asset compilation
- **Heroicons** for Filament UI icons

## Integration Points

### Filament Panels
- Admin panel registers at `app/Providers/Filament/AdminPanelProvider.php`
- Resources auto-discovered from `app/Filament/Resources/`
- Custom middleware for auth: `web` guard, not `auth`

### File Storage
- Public disk: `storage/app/public/` symlinked to `public/storage/`
- Document paths: `project-docs/{project_id}/{timestamp}_{filename}`
- Storage facade used throughout: `Storage::disk('public')`

### Error Handling
- Laravel logs: `storage/logs/laravel.log`
- Filament notifications for user feedback
- Console logging for AJAX operations debugging

When modifying this codebase:
1. **Filament Resources** - Use form schemas and table columns, avoid manual HTML
2. **AJAX Operations** - Follow Alpine.js inline pattern for immediate feedback
3. **Migrations** - Always check existing columns before adding new ones
4. **Status Updates** - Update related timestamp fields when changing project status
